<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_blank
 * @package    Mage
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<!--  The "i" after the pattern delimiter indicates a case-insensitive search  -->
<?php if ($_isFlash = preg_match('#(.flv)|(.avi)|(.swf)$#i', $this->getImageFile())): ?>
<?php $_width=470; $_height=320; ?>
<?php else: ?>
<?php $_width=$this->getImageWidth() ?>
<?php endif; ?>
<div class="product-image-popup" style="width:<?php echo $_width; ?>px;">
    <p class="a-right"><a href="#" onclick="window.close(); return false;"><?php echo $this->__('Close Window') ?></a></p>
    <?php if($this->getPreviusImageUrl() || $this->getNextImageUrl()): ?>
        <div class="nav">
          <?php if($_prevUrl = $this->getPreviusImageUrl()): ?>
              <a href="<?php echo $_prevUrl ?>">&laquo; <?php echo $this->__('Prev') ?></a>
          <?php endif; ?>
          <?php if($_nextUrl = $this->getNextImageUrl()): ?>
              <a href="<?php echo $_nextUrl ?>"><?php echo $this->__('Next') ?> &raquo;</a>
          <?php endif; ?>
        </div>
    <?php endif; ?>
    <?php if($_imageTitle = $this->htmlEscape($this->getCurrentImage()->getLabel())): ?>
        <h2 class="image-label"><?php echo $_imageTitle ?></h2>
    <?php endif; ?>
    
    <?php if($_isFlash): /* -------------------------------- FLASH  DISPLAY --------------------------------- */ ?>
  		<div class="clear"></div>
			<script type='text/javascript' src='<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS) ?>flowplayer/flowplayer-3.2.6.min.js'></script>
			

			<a  
				href="<?php echo $this->getImageUrl(); ?>"  
			    style="display:block;width:425px;height:300px;"  
			    id="player"> 
			</a> 
 
			<script> 
			    flowplayer("player", "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS) ?>flowplayer/flowplayer-3.2.7.swf"); 
			</script> 
  			<!--  <div id='preview'>This div will be replaced

  				<script type='text/javascript'>
  				//<![CDATA[
				  var s1 = new SWFObject('<?php echo Mage::getUrl() ?>videos/player.swf','ply','<?php echo $_width ?>','<?php echo $_height ?>','9','#ffffff');
				  s1.addParam('allowfullscreen','true');
				  s1.addParam('allowscriptaccess','always');
				  s1.addParam('wmode','opaque');
				  s1.addParam('flashvars','file=<?php echo $this->getImageUrl() ?>');
				  s1.write('preview');
				//]]>
				</script>
			</div>  -->
	
    <?php else: /* -------------------------------- IMAGE  DISPLAY --------------------------------- */ ?>
    	<img<?php if($_width): ?> width="<?php echo $_width ?>"<?php endif; ?> src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'image', $this->getImageFile()); ?>" alt="<?php echo $this->htmlEscape($this->getCurrentImage()->getLabel()) ?>" title="<?php echo $this->htmlEscape($this->getCurrentImage()->getLabel()) ?>" id="product-gallery-image" class="image" />
    <?php endif; ?>
    
    <?php if($this->getPreviusImageUrl() || $this->getNextImageUrl()): ?>
        <div class="nav">
          <?php if($_prevUrl = $this->getPreviusImageUrl()): ?>
              <a href="<?php echo $_prevUrl ?>">&laquo; <?php echo $this->__('Prev') ?></a>
          <?php endif; ?>
          <?php if($_nextUrl = $this->getNextImageUrl()): ?>
              <a href="<?php echo $_nextUrl ?>"><?php echo $this->__('Next') ?> &raquo;</a>
          <?php endif; ?>
        </div>
    <?php endif; ?>
    <p class="a-right"><a href="#" onclick="window.close(); return false;"><?php echo $this->__('Close Window') ?></a></p>
</div>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){
	<?php if($_isFlash): ?>
				var demensions = $('player').getDimensions();
				window.resizeTo(demensions.width+100, demensions.height+230);
	<?php else: ?>
    	var demensions = $('product-gallery-image').getDimensions();
    	window.resizeTo(demensions.width+90, demensions.height+210);
    <?php endif; ?>
});
//]]>
</script>
