<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php /* @var $this Mage_Catalog_Block_Product_View_Abstract */?>
<?php $_product = $this->getProduct() ?>

<?php if ($this->displayProductStockStatus()): ?>
    <?php if ($_product->isAvailable()): ?>
        <p class="availability in-stock"><?php echo $this->__('Availability:') ?> <span><?php echo $this->__('In stock') ?></span></p>
    <?php else: ?>
        <p class="availability out-of-stock"><?php echo $this->__('Availability:') ?> <span><?php echo $this->__('Out of stock') ?></span></p>
    <?php endif; ?>
<?php endif; ?>

<div>
	<label for="kassenzeichen">Kassenzeichen</label>
	<input name="pay_id" class="required-entry" id="pay_id">
	<button type="button" onclick="fetchPrice();return false;" id="fetchprice"><?php echo $this->helper('virtualpayid')->__('Fetch Price')?></button>
</div>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>
<script type="text/javascript">
	var fetch_price_url = "<?php echo $this->getKzInfoUrl(); ?>";
	var diff_price_msg = "<?php echo $this->__('Amounts are not equal!');?>";

	Validation.add('validate-both-amounts', 'Please make sure your amounts match.', function(v, input) {
        var dependentInput = $(input.form[input.name == 'amount' ? 'confirmation' : 'amount']),
            isEqualValues  = input.value == dependentInput.value;

        if (isEqualValues && dependentInput.hasClassName('validation-failed')) {
            Validation.test(this.className, dependentInput);
        }

        return dependentInput.value == '' || isEqualValues;
    });


	function fetchPrice(){
		var kz = $j('#pay_id').val();
		
		$j.ajax({
			url: fetch_price_url,
			data: {'pay_id': $j('#pay_id').val()},
			success: function (data) {
	           $j('#price_container').html(data);
	        },
	        error: function (xhr, status) {
	            alert("Sorry, there was a problem!");
	        }
			});
		
	}

	function setPrice(amount = false)
	{
		if(amount === false )
		{
			amount = $j('#amount').val();
		}
        optionsPrice.changePrice('config', {'price': amount, 'oldPrice': 0});
        optionsPrice.reload();
	}
	
	function validateAmount()
	{
		var amount = $j('#amount').val();
		var amount2 = $j('#confirmation').val();
		if(amount != amount2){
			//alert(diff_price_msg);
			setPrice(0);
		}else{
			setPrice();
		}

		
	}

</script>

<div id="price_container">
</div>


<?php //echo $this->getChildHtml('product_type_data_extra') ?>
<?php // echo $this->getPriceHtml($_product) ?>
