<?xml version="1.0" encoding="UTF-8"?>
<layout>
	<adminhtml_sales_order_invoice_new>
		<reference name="content">
			<reference name="sales_invoice_create">
				<reference name="form">
					<reference name="order_items">
						<action method="setTemplate"><template>egovs/extsalesorder/sales/order/invoice/create/items.phtml</template></action>
					</reference>
				</reference>
			</reference>
		</reference>
	</adminhtml_sales_order_invoice_new>

	<adminhtml_sales_order_invoice_updateqty>
		<reference name="order_items">
			<action method="setTemplate"><template>egovs/extsalesorder/sales/order/invoice/create/items.phtml</template></action>
		</reference>
	</adminhtml_sales_order_invoice_updateqty>

	<!-- main layout definition that adds the column -->
    <add_order_grid_column_handle>
        <reference name="sales_order.grid">
            <action method="addColumnAfter" >
                <columnId>owner</columnId>
                <arguments helper="extsalesorder/translate">
                    <translate>
                        <header>Owner</header>
                        <index>owner</index>
                        <type>text</type>
                    </translate>
                </arguments>
                <after>created_at</after>
            </action>
            <action method="addColumnAfter" >
                <columnId>billing_company</columnId>
                <arguments helper="extsalesorder/translate">
                    <translate>
                        <header>Billing Company</header>
                        <index>billing_company</index>
                        <type>text</type>
                    </translate>
                </arguments>
                <after>owner</after>
            </action>
            <action method="addColumnAfter">
                <columnId>billing_address</columnId>
                <arguments helper="extsalesorder/translate">
                    <translate>
                        <header>Billing Address</header>
                        <index>billing_address</index>
                        <type>text</type>
                    </translate>
                </arguments>
                <after>billing_name</after>
            </action>
            <action method="addColumnAfter">
                <columnId>shipping_company</columnId>
                <arguments helper="extsalesorder/translate">
                    <translate>
                        <header>Shipping Company</header>
                        <index>shipping_company</index>
                        <type>text</type>
                    </translate>
                </arguments>
                <after>billing_address</after>
            </action>
            <action method="addColumnAfter">
                <columnId>shipping_address</columnId>
                <arguments helper="extsalesorder/translate">
                    <translate>
                        <header>Shipping Address</header>
                        <index>shipping_address</index>
                        <type>text</type>
                    </translate>
                </arguments>
                <after>shipping_name</after>
            </action>
            <action method="addColumnAfter">
                <columnId>base_balance</columnId>
                <arguments helper="extsalesorder/translate">
                    <translate>
                        <header>Balance (Base)</header>
                        <index>base_grand_total</index>
                        <index_paid>base_total_paid</index_paid>
                        <filter_index>(base_grand_total - ifnull(base_total_paid, 0))</filter_index>
                        <renderer>egovsbase/adminhtml_widget_grid_column_renderer_balance</renderer>
                        <type>currency</type>
                        <currency>base_currency_code</currency>
                    </translate>
                </arguments>
                <after>grand_total</after>
            </action>
        </reference>
    </add_order_grid_column_handle>
    <!-- order grid action -->
    <adminhtml_sales_order_grid>
        <!-- apply the layout handle defined above -->
        <update handle="add_order_grid_column_handle" />
    </adminhtml_sales_order_grid>
    <!-- order grid view action -->
    <adminhtml_sales_order_index>
         <!-- apply the layout handle defined above -->
        <update handle="add_order_grid_column_handle" />
    </adminhtml_sales_order_index>


		<adminhtml_extsalesorder_creditmemo_new>
				<reference name="content">
						<block type="extsalesorder/adminhtml_sales_order_creditmemo_create" name="sales_creditmemo_create">
								<block type="adminhtml/sales_order_creditmemo_create_form" name="form" template="sales/order/creditmemo/create/form.phtml">
										<block type="adminhtml/sales_order_view_info" name="order_info" template="sales/order/view/info.phtml"></block>
										<block type="adminhtml/sales_order_payment" name="order_payment"></block>
										<block type="extsalesorder/adminhtml_sales_order_creditmemo_create_items" name="order_items" template="egovs/extsalesorder/sales/order/creditmemo/create/items.phtml">
												<action method="addItemRender"><type>default</type><block>extsalesorder/adminhtml_sales_order_creditmemo_items_renderer_default</block><template>egovs/extsalesorder/sales/order/creditmemo/create/items/renderer/default.phtml</template></action>
												<action method="addColumnRender"><column>qty</column><block>adminhtml/sales_items_column_qty</block><template>sales/items/column/qty.phtml</template></action>
												<action method="addColumnRender"><column>name</column><block>adminhtml/sales_items_column_name</block><template>sales/items/column/name.phtml</template></action>
												<action method="addColumnRender"><column>name</column><block>adminhtml/sales_items_column_name_grouped</block><template>sales/items/column/name.phtml</template><type>grouped</type></action>
												<block type="core/text_list" name="order_item_extra_info"></block>
												<block type="adminhtml/sales_order_totalbar" name="order_totalbar" template="sales/order/totalbar.phtml"></block>

												<block type="adminhtml/sales_order_creditmemo_totals" name="creditmemo_totals" template="sales/order/totals.phtml">
														<block type="adminhtml/sales_order_creditmemo_create_adjustments" name="adjustments" template="sales/order/creditmemo/create/totals/adjustments.phtml" />
														<block type="adminhtml/sales_order_totals_tax" name="tax" template="sales/order/totals/tax.phtml" />

												</block>
												<block type="core/text_list" name="submit_before" />
												<block type="core/text_list" name="submit_after" />
										</block>
								</block>
						</block>
				</reference>
		</adminhtml_extsalesorder_creditmemo_new>

		<adminhtml_extsalesorder_creditmemo_updateqty>
				<block type="extsalesorder/adminhtml_sales_order_creditmemo_create_items" name="order_items" template="egovs/extsalesorder/sales/order/creditmemo/create/items.phtml">
						<action method="addItemRender"><type>default</type><block>adminhtml/sales_items_renderer_default</block><template>sales/order/creditmemo/create/items/renderer/default.phtml</template></action>
						<action method="addColumnRender"><column>qty</column><block>adminhtml/sales_items_column_qty</block><template>sales/items/column/qty.phtml</template></action>
						<action method="addColumnRender"><column>name</column><block>adminhtml/sales_items_column_name</block><template>sales/items/column/name.phtml</template></action>
						<action method="addColumnRender"><column>name</column><block>adminhtml/sales_items_column_name_grouped</block><template>sales/items/column/name.phtml</template><type>grouped</type></action>
						<block type="core/text_list" name="order_item_extra_info"></block>
						<block type="adminhtml/sales_order_totalbar" name="order_totalbar" template="sales/order/totalbar.phtml"></block>

						<block type="adminhtml/sales_order_creditmemo_totals" name="creditmemo_totals" template="sales/order/totals.phtml">
								<block type="adminhtml/sales_order_creditmemo_create_adjustments" name="adjustments" template="sales/order/creditmemo/create/totals/adjustments.phtml" />
								<block type="adminhtml/sales_order_totals_tax" name="tax" template="sales/order/totals/tax.phtml" />
						</block>

						<block type="core/text_list" name="submit_before" />
						<block type="core/text_list" name="submit_after" />
				</block>
		</adminhtml_extsalesorder_creditmemo_updateqty>

		<adminhtml_extsalesorder_sales_order_view>
			<update handle="adminhtml_sales_order_view" /> 
		</adminhtml_extsalesorder_sales_order_view>
		<adminhtml_extsalesorder_sales_order_index>
			<update handle="add_order_grid_column_handle" />
		</adminhtml_extsalesorder_sales_order_index>

</layout>
