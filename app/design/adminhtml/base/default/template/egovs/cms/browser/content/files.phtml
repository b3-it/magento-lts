<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Directory contents template for Wysiwyg Images
 *
 * @see Mage_Adminhtml_Block_Cms_Wysiwyg_Images_Content_Files
 */
?>
<?php
$_width  = $this->getImagesWidth();
$_height = $this->getImagesHeight();
?>
<?php if ($this->getFilesCount() > 0): ?>
    <?php foreach ($this->getFiles() as $file): ?>
    <div class="filecnt egovs-base-media-block" id="<?php echo $this->getFileId($file) ?>">
        <p class="nm" style="height:<?php echo $_height ?>px; width:<?php echo $_width ?>px;">
        <?php
        $_info = pathinfo($this->getFileName($file));
        $_imgs = array('jpg','jepg','gif','png','bmp','tiff');
        $_fname = $this->getFileName($file);

        if( in_array($_info['extension'],$_imgs) ) {
            if($this->getFileThumbUrl($file)) {
                ?><img src="<?php echo $this->getFileThumbUrl($file) ?>" alt="<?php echo $_fname; ?>" title="<?php echo $_fname; ?>" /><?php
            }
        }
        else {
            ?><img src="<?php echo $this->getSkinUrl('images/placeholder/thumbnail.jpg') ?>" alt="<?php echo $_fname; ?>" title="<?php echo $_fname; ?>" /><?php
        }
        ?>
        </p>
        <?php if($this->getFileWidth($file)): ?>
            <small><?php echo $this->getFileWidth($file) ?>x<?php echo $this->getFileHeight($file) ?> <?php echo $this->helper('cms')->__('px.') ?></small><br/>
        <?php endif; ?>
        <small title="<?php echo $_fname; ?>"><?php echo $this->getFileShortName($file); ?></small>
        <?php if ($this->getFileShortName($file) != $this->getFileName($file)): ?>
            <small style="display: none"><?php echo $this->getFileName($file); ?></small>
        <?php endif; ?>
        <br />
        <?php
            $_url = $file->getUrl();
            $baseUrl = Mage::getBaseUrl('media').'wysiwyg/';
            $_url = str_replace($baseUrl, '', $_url);
        ?>
        <span>
            <small><?php echo $this->__('Template-URL:'); ?>
                <span class="template-url">
                    <?php echo $this->escapeHtml(sprintf('{{media url="wysiwyg/%s"}}', $_url)); ?>
                </span>
            </small>
        </span>
    </div>
    <?php endforeach; ?>
    <div class="copy-helper"><input type="text"/></div>
<?php else: ?>
    <?php echo $this->helper('cms')->__('No files found') ?>
<?php endif; ?>
<input type="hidden" id="file-content"/>
<script type="text/javascript">
    $j('div.filecnt small').on('click', function() {
        if( $j(this).css('display') == 'inline' && ($j(this).next().is('small') || $j(this).prev().is('small'))) {
            $j(this).css('display', 'none');
            if ($j(this).next().is('small')) {
                $j(this).next().css('display', 'inline');
            } else {
                $j(this).prev().css('display', 'inline');
            }
        }
    });

    $j('.copy-helper').toggle();
    $j('div.filecnt').on( "click", function() {
        var text = $j(this).find('.template-url').html();

        /** navigator.clipboard.writeText('Text to be copied')
            .then(function() {
            console.log('Text copied to clipboard');
        })
        .catch(err => {
                // This can happen if the user denies clipboard permissions:
                console.error('Could not copy text: ', err);
        });
         */

        var txt = $j('.copy-helper input')

        txt.val(text.trim())
            .css({ width: "1px", height: "1px" });

        $j('.copy-helper').show();

        txt.select();

        if (document.execCommand('copy')) {
            //todo show copy tooltip
            //https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_copy_clipboard2
        }
        $j('.copy-helper').hide();
    });
</script>
