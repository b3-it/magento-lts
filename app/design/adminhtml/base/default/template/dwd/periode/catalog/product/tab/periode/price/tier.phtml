<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/* @var $this Mage_Adminhtml_Block_Catalog_Product_Edit_Tab_Price_Tier */
?>
<?php $_htmlId      = $this->getElement()->getHtmlId() ?>
<?php $_htmlClass   = $this->getElement()->getClass() ?>
<?php $_htmlName    = $this->getElement()->getName() ?>
<?php $_readonly    = $this->getElement()->getReadonly() ?>
<?php $_showWebsite = $this->isShowWebsiteColumn(); ?>
<?php $_editWebsite = $this->isAllowChangeWebsite(); ?>
<?php $_priceValueValidation = $this->getPriceValidation('validate-greater-than-zero'); ?>


<?php $_showWebsite = $this->isShowWebsiteColumn(); ?>
<?php $_showWebsite= $this->isMultiWebsites(); ?>
<tr>
    <td class="label"><?php echo $this->getElement()->getLabel() ?></td>
    <td colspan="10" class="grid tier"><div id="period_tier_label" style="display:none; text-align:left; width:100%;"><?php echo Mage::helper('periode')->__('Tier Price') ?></div>
    <table class="data border" id="period_tier_price_table" style="margin-left:5px; width:260px;">
        <?php if ($_showWebsite): ?>
        <col width="135" />
        <?php endif; ?>
        <col width="120" />
        <col width="95" />
        <col />
        <col width="1" />
        <thead>
            <tr class="headings">
                <th><?php echo Mage::helper('catalog')->__('Qty') ?></th>
                <th><?php echo $this->getPriceColumnHeader(Mage::helper('catalog')->__('Price')) ?></th>
                <th class="last" style="width:20px;"><?php echo Mage::helper('catalog')->__('Action') ?></th>
            </tr>
        </thead>
        <tbody id="<?php echo $_htmlId ?>_container"></tbody>
        <tfoot>
            <tr>
                <td colspan="3" class="a-right"><?php echo $this->getAddButtonHtml() ?></td>
            </tr>
        </tfoot>
    </table>
    <p id="note_periode_tier_price" class="note"><span><?php echo $this->getElement()->getNote() ?></span></td>
</tr>

<script type="text/javascript">
//<![CDATA[

var AboTierPriceRowTemplate = '<tr>'
    + '<td class="nobr"><input class="<?php echo $_htmlClass ?> qty required-entry validate-greater-than-zero" type="text" id="<?php echo $_htmlName ?>[{{index}}][price_qty]" value="{{qty}}" id="periode_tier_price_row_{{index}}_qty" />'
    + ' <small class="nobr"><?php echo Mage::helper("catalog")->__("and above")?></small></td>'
    + '<td><input class="<?php echo $_htmlClass ?> required-entry <?php echo $_priceValueValidation ?>" type="text" id="<?php echo $_htmlName ?>[{{index}}][price]" value="{{price}}" id="periode_tier_price_row_{{index}}_price" /></td>'
    + '<td class="last"><input type="hidden" id="<?php echo $_htmlName ?>[{{index}}][delete]" class="delete" value="" id="tier_price_row_{{index}}_delete" />'
    + '<button title="<?php echo Mage::helper("catalog")->__("Delete Tier") ?>" type="button" class="scalable delete icon-btn delete-product-option" id="tier_price_row_{{index}}_delete_button" onclick="return tierPriceControl.deleteItem(event);">'
    + '<span><?php echo Mage::helper("catalog")->__("Delete") ?></span></button></td>'
    + '</tr>'
;
var button_default     = "<span><?php echo Mage::helper('catalog')->__('Add New Row') ?></span>";
var valid_fail_class   = ' required-entry validation-failed ';
var button_save_update = "<?php echo Mage::helper('periode')->__('Save Row') ?>";
var fail_message       = '<div id="validation-fail-{{index}}" style="text-aling:left;" class="validation-advice">' +
                         '<?php echo Mage::helper('core')->__('This is a required field.') ?></div>';

var AboTierPriceControl = {
		template: new Template(AboTierPriceRowTemplate, new RegExp('(^|.|\\r|\\n)({{\\s*(\\w+)\\s*}})', "")),
		itemsCount: 0,
		addItem : function () {
			var data = {
				qty  : '',
				price: '',
				index: this.itemsCount++
			};

			if(arguments.length >= 2) {
				data.qty   = arguments[0];
				data.price = arguments[1];
			}

			Element.insert($('<?php echo $_htmlId ?>_container'), {
				bottom : this.template.evaluate(data)
			});

			$('<?php echo $_htmlId ?>_container').select('input', 'select').each(function(el){ Event.observe(el, 'change', el.setHasChanges.bind(el)); });
		},
		disableElement: function(el) {
			el.disabled = true;
			el.addClassName('disabled');
		},
		deleteItem: function(event) {
			var tr = Event.findElement(event, 'tr');
			if (tr) {
				Element.select(tr, '.delete').each(function(elem){elem.value='1'});
				Element.select(tr, ['input', 'select']).each(function(elem){elem.hide()});
				Element.hide(tr);
				Element.addClassName(tr, 'no-display template');
			}
			return false;
		}
};

//]]>
</script>